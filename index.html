<body>
<h1>投票アプリ</h1>

<div id="topics"></div>

<script>
async function load() {
    const res = await fetch("/topics");
    const topics = await res.json();
    render(topics);
}

function render(topics) {
    const div = document.getElementById("topics");
    div.innerHTML = "";

    topics.forEach(t => {
        div.innerHTML += `
            <div>
                <h3>${t[1]}</h3>
                <p>${t[2]} 票</p>
                <button onclick="vote(${t[0]})">投票</button>
            </div>
            <hr>
        `;
    });
}

async function vote(id) {
    await fetch("/vote/" + id, { method: "POST" });
}

let ws = new WebSocket("wss://" + location.host + "/ws");

ws.onmessage = (msg) => {
    const data = JSON.parse(msg.data);
    if (data.type === "update") {
        load();  // 更新されたら再読み込み
    }
};

load();
</script>
</body>